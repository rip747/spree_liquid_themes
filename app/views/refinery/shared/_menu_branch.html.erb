<%#TODO migrate to liquid %>
<%
   have_children = ((children = menu_branch.children unless hide_children).present? &&
           (!local_assigns[:menu_levels] || menu_branch.ancestors.length < local_assigns[:menu_levels]))

   css = menu_branch_css(local_assigns)
   css << 'dropdown' if have_children

   if !!local_assigns[:apply_css] and css.any?
     css = "class='#{css.join(' ')}'".html_safe
   end
-%>


<li<%= ['', css].compact.join(' ').gsub(/\ *$/, '').html_safe %>>
  <% if have_children -%>
      <%= link_to("#{menu_branch.title}<b class=\"caret\"></b>".html_safe, refinery.url_for(menu_branch.url), class: 'dropdown-toggle', 'data-toggle' => 'dropdown') -%>
      <ul class="dropdown-menu">
        <%= render :partial => '/refinery/shared/menu_branch', :collection => children,
                   :locals => {
                           :apply_css => local_assigns[:apply_css],
                           :hide_children => !!hide_children,
                           :menu_levels => local_assigns[:menu_levels]
                   } -%>
      </ul>
  <% else %>
      <%= link_to(menu_branch.title, refinery.url_for(menu_branch.url)) -%>
  <% end -%>
</li>

